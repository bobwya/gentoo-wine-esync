--- a/0041-server-Allocate-shared-memory-segments-for-semaphore.patch	2018-10-07 03:47:11.000000000 +0100
+++ b/0041-server-Allocate-shared-memory-segments-for-semaphore.patch	2019-05-06 18:48:27.253115411 +0100
@@ -3,19 +3,15 @@
 Date: Sun, 10 Jun 2018 23:12:16 -0500
 Subject: [PATCH 41/83] server: Allocate shared memory segments for semaphores
  and mutexes.
-
 As has been described in the README, these two objects have state that can't
 be expressed (or read from) the eventfd descriptor. Namely, for semaphores
 we need to know the current lock count, and for mutexes we need to know the
  owner tid and the recursion count. To make these work across processes, we
 store them in a global shared memory section.
-
 This patch has no effect by itself; it's for separation.
-
 We use the WINEPREFIX dir to discriminate shm sections for simultaneously
 running servers; this is based off of code in libwine (specifically
 init_server_dir()).
-
 Signed-off-by: Zebediah Figura <z.figura12@gmail.com>
 ---
  include/wine/server_protocol.h |  6 +++-
@@ -26,12 +22,11 @@
  server/request.h               |  6 ++--
  server/trace.c                 |  2 ++
  7 files changed, 83 insertions(+), 3 deletions(-)
-
 diff --git a/include/wine/server_protocol.h b/include/wine/server_protocol.h
 index 68945ec..c262bee 100644
 --- a/include/wine/server_protocol.h
 +++ b/include/wine/server_protocol.h
-@@ -5660,6 +5660,8 @@ struct create_esync_reply
+@@ -5632,6 +5632,8 @@ struct create_esync_reply
      struct reply_header __header;
      obj_handle_t handle;
      int          type;
@@ -40,7 +35,7 @@
  };
  
  
-@@ -5678,6 +5680,8 @@ struct open_esync_reply
+@@ -5650,6 +5652,8 @@ struct open_esync_reply
      struct reply_header __header;
      obj_handle_t handle;
      int          type;
@@ -49,14 +44,6 @@
  };
  
  
-@@ -6600,6 +6604,6 @@ union generic_reply
-     struct get_esync_fd_reply get_esync_fd_reply;
- };
- 
--#define SERVER_PROTOCOL_VERSION 571
-+#define SERVER_PROTOCOL_VERSION 572
- 
- #endif /* __WINE_WINE_SERVER_PROTOCOL_H */
 diff --git a/server/esync.c b/server/esync.c
 index 399011f..f1a46af 100644
 --- a/server/esync.c
@@ -200,7 +187,7 @@
  #include "wine/library.h"
  
  /* command-line options */
-@@ -141,6 +142,9 @@ int main( int argc, char *argv[] )
+@@ -142,7 +143,10 @@ int main( int argc, char *argv[] )
      sock_init();
      open_master_socket();
  
@@ -208,6 +195,7 @@
 +        esync_init();
 +
      if (debug_level) fprintf( stderr, "wineserver: starting (pid=%ld)\n", (long) getpid() );
+     init_scheduler();
      init_signals();
      init_directories();
 diff --git a/server/protocol.def b/server/protocol.def
@@ -276,4 +264,3 @@
  static void dump_get_esync_fd_request( const struct get_esync_fd_request *req )
 -- 
 2.7.4
-
