--- a/0023-ntdll-wineandroid.drv-winemac.drv-winex11.drv-Store-.patch	2018-10-07 03:47:11.000000000 +0100
+++ b/0023-ntdll-wineandroid.drv-winemac.drv-winex11.drv-Store-.patch	2020-04-23 17:16:54.369235864 +0100
@@ -40,20 +40,23 @@
 index b7cbff3..5cd6f38 100644
 --- a/dlls/ntdll/ntdll.spec
 +++ b/dlls/ntdll/ntdll.spec
-@@ -1511,3 +1511,5 @@
+@@ -1511,6 +1511,8 @@
  # Filesystem
  @ cdecl wine_nt_to_unix_file_name(ptr ptr long long)
  @ cdecl wine_unix_to_nt_file_name(ptr ptr)
 +
 +@ cdecl __wine_esync_set_queue_fd(long)
+ 
+ # User shared data
+ @ cdecl __wine_user_shared_data()
 diff --git a/dlls/ntdll/ntdll_misc.h b/dlls/ntdll/ntdll_misc.h
 index a308f91..7ee4f8c 100644
 --- a/dlls/ntdll/ntdll_misc.h
 +++ b/dlls/ntdll/ntdll_misc.h
 @@ -234,6 +234,7 @@ struct ntdll_thread_data
-     int                wait_fd[2];    /* fd for sleeping server requests */
      BOOL               wow64_redir;   /* Wow64 filesystem redirection flag */
      pthread_t          pthread_id;    /* pthread thread id */
+     void              *pthread_stack; /* pthread stack */
 +    int                esync_queue_fd;/* fd to wait on for driver events */
  };
  
@@ -70,14 +73,14 @@
  
      signal_init_thread( teb );
      virtual_init_threading();
-@@ -659,6 +660,7 @@ NTSTATUS WINAPI RtlCreateUserThread( HANDLE process, SECURITY_DESCRIPTOR *descr,
+@@ -830,6 +831,7 @@ NTSTATUS WINAPI RtlCreateUserThread( HANDLE process, SECURITY_DESCRIPTOR *descr,
      thread_data->wait_fd[0]  = -1;
      thread_data->wait_fd[1]  = -1;
      thread_data->start_stack = (char *)teb->Tib.StackBase;
 +    thread_data->esync_queue_fd = -1;
  
-     pthread_attr_init( &attr );
-     pthread_attr_setstack( &attr, teb->DeallocationStack,
+     pthread_attr_init( &pthread_attr );
+     pthread_attr_setstack( &pthread_attr, teb->DeallocationStack,
 diff --git a/dlls/wineandroid.drv/window.c b/dlls/wineandroid.drv/window.c
 index aebe4c5..3bc3703 100644
 --- a/dlls/wineandroid.drv/window.c
