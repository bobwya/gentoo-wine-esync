--- a/0041-server-Allocate-shared-memory-segments-for-semaphore.patch	2018-10-07 03:47:11.000000000 +0100
+++ b/0041-server-Allocate-shared-memory-segments-for-semaphore.patch	2020-04-29 20:41:34.929352575 +0100
@@ -31,7 +31,7 @@
 index 68945ec..c262bee 100644
 --- a/include/wine/server_protocol.h
 +++ b/include/wine/server_protocol.h
-@@ -5660,6 +5660,8 @@ struct create_esync_reply
+@@ -5632,6 +5632,8 @@ struct create_esync_reply
      struct reply_header __header;
      obj_handle_t handle;
      int          type;
@@ -40,7 +40,7 @@
  };
  
  
-@@ -5678,6 +5680,8 @@ struct open_esync_reply
+@@ -5650,6 +5652,8 @@ struct open_esync_reply
      struct reply_header __header;
      obj_handle_t handle;
      int          type;
@@ -49,14 +49,6 @@
  };
  
  
-@@ -6600,6 +6604,6 @@ union generic_reply
-     struct get_esync_fd_reply get_esync_fd_reply;
- };
- 
--#define SERVER_PROTOCOL_VERSION 571
-+#define SERVER_PROTOCOL_VERSION 572
- 
- #endif /* __WINE_WINE_SERVER_PROTOCOL_H */
 diff --git a/server/esync.c b/server/esync.c
 index 399011f..f1a46af 100644
 --- a/server/esync.c
@@ -200,7 +192,7 @@
  #include "wine/library.h"
  
  /* command-line options */
-@@ -141,6 +142,9 @@ int main( int argc, char *argv[] )
+@@ -142,7 +143,10 @@ int main( int argc, char *argv[] )
      sock_init();
      open_master_socket();
  
@@ -208,6 +200,7 @@
 +        esync_init();
 +
      if (debug_level) fprintf( stderr, "wineserver: starting (pid=%ld)\n", (long) getpid() );
+     init_scheduler();
      init_signals();
      init_directories();
 diff --git a/server/protocol.def b/server/protocol.def
