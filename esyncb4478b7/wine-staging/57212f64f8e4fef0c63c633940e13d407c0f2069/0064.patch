--- a/0064-server-Create-eventfd-descriptors-for-pseudo-fd-obje.patch	2018-10-07 03:47:11.000000000 +0100
+++ b/0064-server-Create-eventfd-descriptors-for-pseudo-fd-obje.patch	2020-04-12 23:48:31.206392803 +0100
@@ -3,14 +3,12 @@
 Date: Sat, 7 Jul 2018 12:57:47 +0200
 Subject: [PATCH 64/83] server: Create eventfd descriptors for pseudo-fd
  objects and use them for named pipes.
-
 Signed-off-by: Zebediah Figura <z.figura12@gmail.com>
 ---
  server/fd.c         | 22 ++++++++++++++++++++++
  server/file.h       |  1 +
  server/named_pipe.c |  4 ++--
  3 files changed, 25 insertions(+), 2 deletions(-)
-
 diff --git a/server/fd.c b/server/fd.c
 index 3388de9..4d02b3b 100644
 --- a/server/fd.c
@@ -24,9 +22,9 @@
  #include "winternl.h"
  #include "winioctl.h"
 @@ -194,6 +195,7 @@ struct fd
-     struct async_queue   wait_q;      /* other async waiters of this fd */
      struct completion   *completion;  /* completion object attached to this fd */
      apc_param_t          comp_key;    /* completion key to set in completion events */
+     unsigned int         comp_flags;  /* completion flags */
 +    int                  esync_fd;    /* esync file descriptor */
  };
  
@@ -42,16 +40,16 @@
  
  /* check if the desired access is possible without violating */
 @@ -1608,6 +1613,7 @@ static struct fd *alloc_fd_object(void)
-     fd->fs_locks   = 1;
      fd->poll_index = -1;
      fd->completion = NULL;
+     fd->comp_flags = 0;
 +    fd->esync_fd   = -1;
      init_async_queue( &fd->read_q );
      init_async_queue( &fd->write_q );
      init_async_queue( &fd->wait_q );
 @@ -1644,11 +1650,15 @@ struct fd *alloc_pseudo_fd( const struct fd_ops *fd_user_ops, struct object *use
-     fd->poll_index = -1;
      fd->completion = NULL;
+     fd->comp_flags = 0;
      fd->no_fd_status = STATUS_BAD_DEVICE_TYPE;
 +    fd->esync_fd   = -1;
      init_async_queue( &fd->read_q );
@@ -127,4 +125,3 @@
      pipe_end_get_fd,              /* get_fd */
 -- 
 2.7.4
-
