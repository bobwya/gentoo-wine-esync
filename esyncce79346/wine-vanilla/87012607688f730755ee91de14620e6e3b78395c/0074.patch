--- a/0074-ntdll-server-Abort-if-esync-is-enabled-for-the-serve.patch	2018-11-01 17:19:44.000000000 +0000
+++ b/0074-ntdll-server-Abort-if-esync-is-enabled-for-the-serve.patch	2020-04-23 17:16:53.042252343 +0100
@@ -1,13 +1,13 @@
-From 7b617b003abd29e7869178cb8ca108802691159f Mon Sep 17 00:00:00 2001
+From 4293d1e7797b999611ecc410b24052a1566715b6 Mon Sep 17 00:00:00 2001
 From: Zebediah Figura <z.figura12@gmail.com>
 Date: Sat, 4 Aug 2018 15:15:12 -0500
-Subject: [PATCH 74/83] ntdll, server: Abort if esync is enabled for the server
- but not the client, and vice versa.
+Subject: [PATCH] ntdll, server: Abort if esync is enabled for the server but
+ not the client, and vice versa.
 
 Signed-off-by: Zebediah Figura <z.figura12@gmail.com>
 ---
  dlls/ntdll/esync.c  | 28 +++++++++++++++++++++++++++-
- dlls/ntdll/thread.c |  3 +--
+ dlls/ntdll/loader.c |  3 +--
  server/esync.c      | 12 ++++++++++++
  3 files changed, 40 insertions(+), 3 deletions(-)
 
@@ -61,21 +61,21 @@
  
      pagesize = sysconf( _SC_PAGESIZE );
  
-diff --git a/dlls/ntdll/thread.c b/dlls/ntdll/thread.c
-index cd94e56b1d..99aaf29a5d 100644
---- a/dlls/ntdll/thread.c
-+++ b/dlls/ntdll/thread.c
-@@ -403,8 +403,7 @@ void thread_init(void)
- 
-     fill_cpu_info();
+diff --git a/dlls/ntdll/loader.c b/dlls/ntdll/loader.c
+index f9c529357..80f1304a3 100644
+--- a/dlls/ntdll/loader.c
++++ b/dlls/ntdll/loader.c
+@@ -4405,8 +4405,7 @@ void __wine_process_init(void)
+     peb->ProcessHeap = RtlCreateHeap( HEAP_GROWABLE, NULL, 0, 0, NULL, NULL );
+     peb->LoaderLock = &loader_section;
  
 -    if (do_esync())
 -        esync_init();
 +    esync_init();
  
-     NtCreateKeyedEvent( &keyed_event, GENERIC_READ | GENERIC_WRITE, NULL, 0 );
- }
-diff --git a/server/esync.c b/server/esync.c
+     init_unix_codepage();
+     init_directories();
+     init_user_process_params( info_size );
 index a0745a2306..10001a243b 100644
 --- a/server/esync.c
 +++ b/server/esync.c
@@ -99,5 +99,5 @@
  
      if ((esync = create_esync( root, &name, objattr->attributes, req->initval, req->flags, req->type, sd )))
 -- 
-2.19.1
+2.23.0
 
