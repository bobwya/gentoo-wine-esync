--- a/0079-ntdll-server-Revert-to-old-implementation-of-hung-qu.patch	2018-11-01 17:19:44.000000000 +0000
+++ b/0079-ntdll-server-Revert-to-old-implementation-of-hung-qu.patch	2020-04-29 20:41:33.474358289 +0100
@@ -33,7 +33,7 @@
 @@ -812,8 +812,8 @@ static void update_grabbed_object( struct esync *obj )
  
  /* A value of STATUS_NOT_IMPLEMENTED returned from this function means that we
-  * need to delegate to server_select(). */
+  * need to delegate to server_wait(). */
 -NTSTATUS esync_wait_objects( DWORD count, const HANDLE *handles, BOOLEAN wait_any,
 -                             BOOLEAN alertable, const LARGE_INTEGER *timeout )
 +static NTSTATUS __esync_wait_objects( DWORD count, const HANDLE *handles,
@@ -58,7 +58,7 @@
 -         * hung queues. Do it like this. */
 -        select_op.wait.op = SELECT_WAIT;
 -        select_op.wait.handles[0] = wine_server_obj_handle( handles[count - 1] );
--        ret = server_select( &select_op, offsetof( select_op_t, wait.handles[1] ), 0, &zero );
+-        ret = server_wait( &select_op, offsetof( select_op_t, wait.handles[1] ), 0, &zero );
 -        if (ret != STATUS_WAIT_0 && ret != STATUS_TIMEOUT)
 -            ERR("Unexpected ret %#x\n", ret);
      }
@@ -147,17 +147,14 @@
  };
  union generic_reply
  {
-@@ -6631,8 +6644,9 @@ union generic_reply
+@@ -6937,6 +6950,7 @@ union generic_reply
      struct open_esync_reply open_esync_reply;
      struct get_esync_fd_reply get_esync_fd_reply;
      struct get_esync_apc_fd_reply get_esync_apc_fd_reply;
 +    struct esync_msgwait_reply esync_msgwait_reply;
  };
  
--#define SERVER_PROTOCOL_VERSION 576
-+#define SERVER_PROTOCOL_VERSION 577
- 
- #endif /* __WINE_WINE_SERVER_PROTOCOL_H */
+ /* ### protocol_version begin ### */
 diff --git a/server/protocol.def b/server/protocol.def
 index e79c5fe8fd..4caece2185 100644
 --- a/server/protocol.def
@@ -265,7 +262,7 @@
 +    (req_handler)req_esync_msgwait,
  };
  
- C_ASSERT( sizeof(affinity_t) == 8 );
+ C_ASSERT( sizeof(abstime_t) == 8 );
 @@ -2438,7 +2440,8 @@ C_ASSERT( FIELD_OFFSET(struct get_esync_fd_reply, type) == 8 );
  C_ASSERT( FIELD_OFFSET(struct get_esync_fd_reply, shm_idx) == 12 );
  C_ASSERT( sizeof(struct get_esync_fd_reply) == 16 );
