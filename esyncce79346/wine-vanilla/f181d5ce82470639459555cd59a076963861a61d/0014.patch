--- a/0014-server-Add-a-request-to-get-the-eventfd-file-descrip.patch	2018-11-01 17:19:43.000000000 +0000
+++ b/0014-server-Add-a-request-to-get-the-eventfd-file-descrip.patch	2020-04-23 17:16:50.369285689 +0100
@@ -36,29 +36,29 @@
  {
      REQ_new_process,
 @@ -5967,6 +5978,7 @@ enum request
-     REQ_set_job_completion_port,
-     REQ_terminate_job,
+     REQ_suspend_process,
+     REQ_resume_process,
      REQ_create_esync,
 +    REQ_get_esync_fd,
      REQ_NB_REQUESTS
  };
  
 @@ -6266,6 +6278,7 @@ union generic_request
-     struct set_job_completion_port_request set_job_completion_port_request;
-     struct terminate_job_request terminate_job_request;
+     struct suspend_process_request suspend_process_request;
+     struct resume_process_request resume_process_request;
      struct create_esync_request create_esync_request;
 +    struct get_esync_fd_request get_esync_fd_request;
  };
  union generic_reply
  {
-@@ -6563,6 +6576,7 @@ union generic_reply
-     struct set_job_completion_port_reply set_job_completion_port_reply;
-     struct terminate_job_reply terminate_job_reply;
+@@ -6934,6 +6947,7 @@ union generic_reply
+     struct suspend_process_reply suspend_process_reply;
+     struct resume_process_reply resume_process_reply;
      struct create_esync_reply create_esync_reply;
 +    struct get_esync_fd_reply get_esync_fd_reply;
  };
  
- #define SERVER_PROTOCOL_VERSION 570
+ /* ### protocol_version begin ### */
 diff --git a/server/esync.c b/server/esync.c
 index e761475678..e775b3bd28 100644
 --- a/server/esync.c
@@ -99,7 +99,7 @@
 index b743674ebd..250590573e 100644
 --- a/server/protocol.def
 +++ b/server/protocol.def
-@@ -3865,3 +3865,9 @@ struct handle_info
+@@ -3978,6 +3978,12 @@ struct handle_info
  @REPLY
      obj_handle_t handle;        /* handle to the object */
  @END
@@ -109,21 +109,24 @@
 +    obj_handle_t handle;        /* handle to the object */
 +@REPLY
 +@END
+ 
+ 
+ /* Suspend a process */
 diff --git a/server/request.h b/server/request.h
 index 242143d2c3..272f79dc04 100644
 --- a/server/request.h
 +++ b/server/request.h
 @@ -404,6 +404,7 @@ DECL_HANDLER(set_job_limits);
- DECL_HANDLER(set_job_completion_port);
- DECL_HANDLER(terminate_job);
+ DECL_HANDLER(suspend_process);
+ DECL_HANDLER(resume_process);
  DECL_HANDLER(create_esync);
 +DECL_HANDLER(get_esync_fd);
  
  #ifdef WANT_REQUEST_HANDLERS
  
 @@ -702,6 +703,7 @@ static const req_handler req_handlers[REQ_NB_REQUESTS] =
-     (req_handler)req_set_job_completion_port,
-     (req_handler)req_terminate_job,
+     (req_handler)req_suspend_process,
+     (req_handler)req_resume_process,
      (req_handler)req_create_esync,
 +    (req_handler)req_get_esync_fd,
  };
@@ -156,8 +159,8 @@
      (dump_func)dump_new_process_request,
      (dump_func)dump_exec_process_request,
 @@ -4847,6 +4852,7 @@ static const dump_func req_dumpers[REQ_NB_REQUESTS] = {
-     (dump_func)dump_set_job_completion_port_request,
-     (dump_func)dump_terminate_job_request,
+     (dump_func)dump_suspend_process_request,
+     (dump_func)dump_resume_process_request,
      (dump_func)dump_create_esync_request,
 +    (dump_func)dump_get_esync_fd_request,
  };
@@ -172,8 +175,8 @@
  
  static const char * const req_names[REQ_NB_REQUESTS] = {
 @@ -5437,6 +5444,7 @@ static const char * const req_names[REQ_NB_REQUESTS] = {
-     "set_job_completion_port",
-     "terminate_job",
+     "suspend_process",
+     "resume_process",
      "create_esync",
 +    "get_esync_fd",
  };
